<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Component Library</title>
    <link rel="stylesheet" href="css/app.css" />
</head>
<body>

    <div class="main-container">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-menu" id="sidebar-menu">
                <!-- Menu items will be generated by JavaScript -->
            </div>
        </div>
        <button class="fab" id="fabButton" onclick="createComponentManager()">+</button>
        <button class="sidebar-toggle" id="sidebar-toggle">â˜°</button>
        <!-- Theme Toggle Switch -->
        <div class="theme-switch-container">
            <label class="theme-switch">
                <input type="checkbox" id="theme-toggle">
                <span class="theme-slider"></span>
            </label>
            <span class="theme-icon">ðŸŒ™</span>
        </div>

        <div class="content" id="content">
            <!-- Loading indicator -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Loading component...</p>
            </div>

            <!-- Content will be loaded here -->
        </div>
    </div>
    <script src="js/app.js"></script>
    <script>
        let toggle = true;
        // Menu structure data
        const menuData = [
            {
                category: "First Steps",
                items: ["UI setup component search"]
            },
            {
                category: "Badges & Tags",
                items: ["Badge"]
            },
            {
                category: "Buttons",
                items: ["Button", "Button Group", "Button close", "Button with icon only", "Social button", "Store badges"]
            },
            {
                category: "Checkboxes",
                items: ["Checkbox", "Checkbox label"]
            },
            {
                category: "Content",
                items: ["Content Frames", "Content Slots", "Content Header", "Content Slot"]
            },
            {
                category: "Dividers",
                items: ["Divider"]
            },
            {
                category: "Drop-Downs",
                items: ["Drop-Down Box", "Drop-Down Menu"]
            },
            {
                category: "Empty States",
                items: ["Empty state", "Empty state graphic"]
            },
            {
                category: "Icons",
                items: ["Icons"]
            },
            {
                category: "Info Cards",
                items: ["Info card"]
            },
            {
                category: "Inbox",
                items: ["Content / Inbox / Classic", "Content / Inbox / Compact", "Mail navigation list item"]
            },
            {
                category: "Lists",
                items: ["Check list item", "Class list item"]
            },
            {
                category: "Logos",
                items: ["GGLOGO", "GG_LOGO_ICON", "GG_LOGO_MARK"]
            },
            {
                category: "Modals",
                items: ["Modal header", "Modal actions"]
            },
            {
                category: "Pagination",
                items: ["Pagination", "Pagination dots"]
            },
            {
                category: "Progress Loaders",
                items: ["Linear loader", "Linear loader (looping)", "Radial loader", "Radial loader (looping)", "Radial loader (looping) 2"]
            },
            {
                category: "Radio Buttons",
                items: ["Radio Button", "Radio Button Group"]
            },
            {
                category: "Toggles",
                items: ["Toggle switch", "Toggle label"]
            },
            {
                category: "Tabs",
                items: ["Horizontal tabs", "Vertical tabs", "Tab button"]
            },
            {
                category: "Accordion",
                items: ["Accordion", "Accordion item"]
            },
            {
                category: "Headers",
                items: ["Card header", "Page header", "Section header"]
            },
            {
                category: "Signup & Login",
                items: ["Login sections", "Signup sections"]
            },
            {
                category: "Miscellaneous",
                items: ["Avatar", "Avatar labeled", "Avatar stack"]
            },

        ];

        // Generate menu
        const sidebarMenu = document.getElementById('sidebar-menu');
        const contentContainer = document.getElementById('content');
        const loadingIndicator = document.getElementById('loading');

        menuData.forEach((menuItem, index) => {
            const categoryElement = document.createElement('div');
            categoryElement.className = 'category';

            // Pre-expand the Buttons category
            if (menuItem.category === "First Steps") {
                categoryElement.classList.add('active');
            }

            categoryElement.innerHTML = `
                <div class="category-header">
                    ${menuItem.category}
                    <span class="toggle-icon">${menuItem.category === "UI setup component search" ? 'â¬¤' : 'â—‹'}</span>
                </div>
                <div class="category-items">
                    ${menuItem.items.map(item => {
                // Set Button as active by default
                const isActive = item === "UI setup component search" ? "active" : "";
                // Create URL-friendly id from item name
                const itemId = item.toLowerCase().replace(/\s+/g, '-').replace(/\//g, '-');

                return `
                            <a href="#" class="category-item ${isActive}" data-item="${item}" data-page="${itemId}">
                                ${item}
                                <span class="category-item-indicator"></span>
                            </a>
                        `;
            }).join('')}
                </div>
            `;
            sidebarMenu.appendChild(categoryElement);
        });

        // Add this function to your JavaScript
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'  // For smooth scrolling
            });
        }

    // Define a central repository of component information
    const componentRepository = {
        // Example structure - you'll need to populate this with your actual data
    };

    // Function to populate the component repository from navigation data
    function populateComponentRepository() {
        // This function will create entries in componentRepository based on menu data
        menuData.forEach(category => {
            category.items.forEach(item => {
                // Create URL-friendly id from item name
                const itemId = item.toLowerCase().replace(/\s+/g, '-').replace(/\//g, '-');

                // Only add if not already in repository
                if (!componentRepository[itemId]) {
                    componentRepository[itemId] = {
                        name: item,
                        description: "", // Empty by default
                        figmaLink: "", // Empty by default
                        figmaButtonText: item,
                        imagePath1: "", // Empty by default - for first image
                        imagePath2: ""  // Empty by default - for second image
                    };
                }
            });
        });
    }
    async function loadContent(pageName) {
        try {
            // Show loading indicator
            loadingIndicator.classList.add('active');

            // Fetch the content file
            const response = await fetch(`pages/${pageName}.html`);

            if (!response.ok) {
                throw new Error(`Failed to load ${pageName}`);
            }

            const html = await response.text();

            // Hide loading indicator
            loadingIndicator.classList.remove('active');

            // Create the content header
            const contentHeader = `
            <div class="content-header">
                <h1 class="content-title">${pageName.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</h1>
            </div>
        `;

            // Update content
            contentContainer.innerHTML = contentHeader + html;

            // Wait for the DOM to update before injecting component info
            requestAnimationFrame(() => {
                // After content is loaded, inject component information
                injectComponentInfo(pageName);

                // Initialize video viewport observers
                initializeVideos();
            });
        } catch (error) {
            console.error('Error loading content:', error);
            loadingIndicator.classList.remove('active');
            contentContainer.innerHTML = `
            <div class="content-header">
                <h1 class="content-title">${pageName.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</h1>
                <p class="content-subtitle">Content not found or still in development</p>
            </div>
            <div style="text-align: center; padding: 50px;">
                <p>We're still working on this component. Check back soon!</p>
            </div>
        `;
        }
    }

 // Function to inject component information into the loaded page
    function injectComponentInfo(pageName) {
        // Add a small delay to ensure DOM is ready
        setTimeout(() => {
            console.log(`Injecting data for component: ${pageName}`);

            // Look up the component data from our repository
            const componentData = componentRepository[pageName];

            if (!componentData) {
                console.log(`No stored data found for component: ${pageName}`);
                return;
            }

            // Find the component description element - try different selectors
            const descriptionElement = document.querySelector('.component-description p') ||
                document.querySelector('.component-description') ||
                document.querySelector('[data-description-container]');

            if (descriptionElement && componentData.description) {
                console.log('Found description element, updating content');
                descriptionElement.textContent = componentData.description;
            } else {
                console.log('Description element not found in the DOM');
            }

            // Find the Figma link button - try different selectors
            const figmaLink = document.querySelector('.two-tone-button') ||
                document.querySelector('[data-figma-link]') ||
                document.querySelector('a[href*="figma.com"]');

            if (figmaLink && componentData.figmaLink) {
                console.log('Found Figma link element, updating href');
                figmaLink.setAttribute('href', componentData.figmaLink);

                // Update button text if needed
                const buttonLeftElement = figmaLink.querySelector('.button-left');
                if (buttonLeftElement && componentData.figmaButtonText) {
                    // Save the diamond icon HTML
                    const diamondIcon = buttonLeftElement.querySelector('.diamond-icon');
                    const diamondHtml = diamondIcon ? diamondIcon.outerHTML : '';

                    // Replace the content, preserving the diamond icon
                    buttonLeftElement.innerHTML = componentData.figmaButtonText + diamondHtml;
                }
            } else {
                console.log('Figma link element not found in the DOM');
            }

            // Find and update images if paths are provided
            if (componentData.imagePath1 || componentData.imagePath2) {
                console.log('Found image paths, searching for image elements');

                // Find only images with the data-prop-img attribute in grid layout
                const gridImages = document.querySelectorAll('.grid-2-col .grid-item img[data-prop-img]');

                // Update first image if found
                if (gridImages.length > 0 && componentData.imagePath1) {
                    console.log('Updating first image src');
                    gridImages[0].setAttribute('src', componentData.imagePath1);
                    gridImages[0].setAttribute('alt', `${componentData.name} - diagram 1`);
                }

                // Update second image if found
                if (gridImages.length > 1 && componentData.imagePath2) {
                    console.log('Updating second image src');
                    gridImages[1].setAttribute('src', componentData.imagePath2);
                    gridImages[1].setAttribute('alt', `${componentData.name} - diagram 2`);
                }
            }
        }, 100); // Small delay to ensure DOM is updated
    }

    // Function to save component data to downloadable JSON file
    function saveComponentRepository() {
        // Save to localStorage as a backup/cache
        localStorage.setItem('componentRepository', JSON.stringify(componentRepository));

        // Create formatted JSON string
        const jsonData = JSON.stringify(componentRepository, null, 2);

        // Create a blob containing the JSON data
        const blob = new Blob([jsonData], { type: 'application/json' });

        // Create a URL for the blob
        const url = URL.createObjectURL(blob);

        // Create a link element for downloading
        const link = document.createElement('a');
        link.href = url;
        link.download = 'components.json';

        // Append link to body, click it, and remove it
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        // Clean up the URL object
        URL.revokeObjectURL(url);

        console.log('Component repository saved to downloadable JSON file');

        // Display instructions for the user
        alert('Component data has been saved as components.json. To make this data available for future visits, please replace the components.json file in your project\'s data directory with this downloaded file.');
    }
    // Function to load component data from JSON file
    async function loadComponentRepository() {
        try {
            // Fetch the JSON file
            const response = await fetch('data/components.json');

            if (!response.ok) {
                throw new Error(`Failed to load component data: ${response.status}`);
            }

            const loadedData = await response.json();

            // Merge the loaded data with our default data
            Object.assign(componentRepository, loadedData);
            console.log('Component repository loaded from JSON file');

            // Also save to localStorage as a backup/cache
            localStorage.setItem('componentRepository', JSON.stringify(componentRepository));
        } catch (error) {
            console.error('Error loading component repository from file:', error);

            // Fall back to localStorage if available
            const storedData = localStorage.getItem('componentRepository');
            if (storedData) {
                try {
                    const localData = JSON.parse(storedData);
                    Object.assign(componentRepository, localData);
                    console.log('Component repository loaded from localStorage fallback');
                } catch (e) {
                    console.error('Error parsing localStorage data:', e);
                }
            }
        } finally {
            // Ensure we have entries for all components by populating missing ones
            populateComponentRepository();
        }
    }

    function createComponentManager() {
        const managerHtml = `
    <div class="component-manager">
        <h2>Component Data Manager</h2>
        <p>Use this tool to manage component descriptions, Figma links, and images.</p>

        <div class="info-box">
            <h3>How Data Storage Works</h3>
            <p>Data is loaded from <code>data/components.json</code> when the page loads.</p>
            <p>Changes you make here are saved to your browser's local storage temporarily.</p>
            <p>To permanently save changes, click "Export Data" and replace your project's components.json file with the downloaded file.</p>
        </div>

        <div class="data-actions">
            <button id="export-components" class="export-button">Export Data (components.json)</button>
            <button id="import-components" class="import-button">Import Data</button>
        </div>

        <div class="component-selector">
            <label for="component-select">Select Component:</label>
            <select id="component-select" class="component-select">
                <option value="">-- Select a component --</option>
                ${Object.keys(componentRepository).map(key =>
            `<option value="${key}">${componentRepository[key].name}</option>`
        ).join('')}
            </select>
        </div>

        <div class="component-form" id="component-form" style="display: none;">
            <div class="form-group">
                <label for="component-name">Component Name:</label>
                <input type="text" id="component-name" class="form-input">
            </div>

            <div class="form-group">
                <label for="component-description">Description:</label>
                <textarea id="component-description" class="form-textarea" rows="4"></textarea>
            </div>

            <div class="form-group">
                <label for="component-figma-link">Figma Link:</label>
                <input type="text" id="component-figma-link" class="form-input">
            </div>

            <div class="form-group">
                <label for="component-button-text">Button Text:</label>
                <input type="text" id="component-button-text" class="form-input">
            </div>

            <div class="form-group">
                <label for="component-image-path1">Image Path 1:</label>
                <input type="text" id="component-image-path1" class="form-input" placeholder="e.g., assets/prop_table/component_name.jpg">
            </div>

            <div class="form-group">
                <label for="component-image-path2">Image Path 2:</label>
                <input type="text" id="component-image-path2" class="form-input" placeholder="e.g., assets/img/component_name.jpg">
            </div>

            <div class="form-actions">
                <button id="save-component" class="save-button">Save Component Data</button>
            </div>
        </div>
    </div>
`;

        contentContainer.innerHTML = managerHtml;

        // Add event listeners
        const componentSelect = document.getElementById('component-select');
        const componentForm = document.getElementById('component-form');
        const componentName = document.getElementById('component-name');
        const componentDescription = document.getElementById('component-description');
        const componentFigmaLink = document.getElementById('component-figma-link');
        const componentButtonText = document.getElementById('component-button-text');
        const componentImagePath1 = document.getElementById('component-image-path1');
        const componentImagePath2 = document.getElementById('component-image-path2');
        const saveButton = document.getElementById('save-component');
        const exportButton = document.getElementById('export-components');
        const importButton = document.getElementById('import-components');

        // Handle component selection
        componentSelect.addEventListener('change', function () {
            const selectedKey = this.value;

            if (selectedKey) {
                const data = componentRepository[selectedKey];

                // Populate form
                componentName.value = data.name || '';
                componentDescription.value = data.description || '';
                componentFigmaLink.value = data.figmaLink || '';
                componentButtonText.value = data.figmaButtonText || '';
                componentImagePath1.value = data.imagePath1 || '';
                componentImagePath2.value = data.imagePath2 || '';

                // Show form
                componentForm.style.display = 'block';
            } else {
                // Hide form if no component selected
                componentForm.style.display = 'none';
            }
        });

        // Handle save button
        saveButton.addEventListener('click', function () {
            const selectedKey = componentSelect.value;

            if (selectedKey) {
                // Update repository
                componentRepository[selectedKey] = {
                    name: componentName.value,
                    description: componentDescription.value,
                    figmaLink: componentFigmaLink.value,
                    figmaButtonText: componentButtonText.value,
                    imagePath1: componentImagePath1.value,
                    imagePath2: componentImagePath2.value
                };

                // Save to localStorage
                localStorage.setItem('componentRepository', JSON.stringify(componentRepository));

                // Provide feedback
                alert(`Component "${componentName.value}" data saved to local storage. To permanently save this data, click "Export Data".`);
            }
        });

        // Add export/import functionality
        exportButton.addEventListener('click', saveComponentRepository);
        importButton.addEventListener('click', importComponentRepository);
    }

        // Add this function to ensure consistent sidebar closing behavior
            function closeSidebarOnMobile() {
                if (window.innerWidth <= 768) {
                    const sidebar = document.getElementById('sidebar');
                    sidebar.classList.remove('active');
                    document.body.classList.remove('sidebar-open');
                }
            }
        // Add event listeners to category headers - updated to close other categories and activate first item
        document.querySelectorAll('.category-header').forEach(header => {
        header.addEventListener('click', () => {
            const parent = header.parentElement;
            const toggleIcon = header.querySelector('.toggle-icon');
            const isActive = parent.classList.contains('active');

            // Close all categories first
            document.querySelectorAll('.category').forEach(cat => {
                cat.classList.remove('active');
                cat.querySelector('.toggle-icon').textContent = 'â—‹';
            });

            // Remove active class from all items
            document.querySelectorAll('.category-item').forEach(i => {
                i.classList.remove('active');
            });

            // If the clicked category wasn't active, make it active
            if (!isActive) {
                parent.classList.add('active');
                toggleIcon.textContent = 'â¬¤';

                // Find and activate the first item in this category
                const firstItem = parent.querySelector('.category-item');
                if (firstItem) {
                    firstItem.classList.add('active');

                    // Get page name from the first item
                    const pageName = firstItem.getAttribute('data-page');

                    // Load the content of the first item
                    loadContent(pageName);
                    // Scroll to top
                    scrollToTop();

                    // Close sidebar on mobile after selection
                    closeSidebarOnMobile();
                }
            }
        });
    });

        // Add event listeners for sidebar toggle on mobile
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebar = document.getElementById('sidebar');

        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('active');
            document.body.classList.toggle('sidebar-open');
        });

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', (e) => {
            if (window.innerWidth <= 768 &&
                !sidebar.contains(e.target) &&
                !sidebarToggle.contains(e.target) &&
                sidebar.classList.contains('active')) {
                sidebar.classList.remove('active');
                document.body.classList.remove('sidebar-open');
            }
        });

        // Update the category item click event
            document.querySelectorAll('.category-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();

                    // Remove active class from all items
                    document.querySelectorAll('.category-item').forEach(i => {
                        i.classList.remove('active');
                    });

                    // Add active class to clicked item
                    item.classList.add('active');

                    // Get page name
                    const pageName = item.getAttribute('data-page');

                    // Load the content
                    loadContent(pageName);

                    // Scroll to top
                    scrollToTop();

                    // Close sidebar on mobile
                    closeSidebarOnMobile();
                });
            });

        // Function to initialize video viewport observers
        function initializeVideos() {
            const videos = document.querySelectorAll('video');

            if (videos.length === 0) return;

            // For each video, add status indicator and set up IntersectionObserver
            videos.forEach((video, index) => {
                // Add unique ID to each video
                video.id = `video-${index}`;

                // Add status indicator to video container
                const videoContainer = video.closest('.video-container') || video.parentElement;

                // Only add indicator if it doesn't already exist
                if (!videoContainer.querySelector('.video-status-indicator')) {
                    const statusIndicator = document.createElement('div');
                    statusIndicator.className = 'video-status-indicator';
                    statusIndicator.textContent = 'Paused';
                    statusIndicator.id = `indicator-${index}`;
                    videoContainer.style.position = 'relative';
                    videoContainer.appendChild(statusIndicator);
                }

                // Create Intersection Observer to watch each video
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        // Get status indicator for this video
                        const indicator = document.getElementById(`indicator-${index}`);

                        if (entry.isIntersecting) {
                            // Video is in viewport
                            // Pause all other videos first
                            videos.forEach(otherVideo => {
                                if (otherVideo.id !== video.id) {
                                    otherVideo.pause();
                                    // Update other indicators
                                    const otherIndex = otherVideo.id.split('-')[1];
                                    const otherIndicator = document.getElementById(`indicator-${otherIndex}`);
                                    if (otherIndicator) otherIndicator.textContent = 'Paused';
                                }
                            });

                            // Play this video
                            if (video.paused) {
                                const playPromise = video.play();

                                // Handle play promise (to avoid DOMException)
                                if (playPromise !== undefined) {
                                    playPromise.then(() => {
                                        // Video playback started successfully
                                        if (indicator) indicator.textContent = 'Playing';
                                    }).catch(error => {
                                        // Auto-play was prevented (e.g., browser policy)
                                        console.log("Auto-play prevented:", error);
                                        if (indicator) indicator.textContent = 'Click to play';
                                    });
                                }
                            }
                        } else {
                            // Video is out of viewport, pause it
                            video.pause();
                            if (indicator) indicator.textContent = 'Paused';
                        }
                    });
                }, {
                    threshold: 0.5 // At least 50% of the video must be visible
                });

                // Start observing the video
                observer.observe(video);

                // Add click event to toggle play/pause manually
                video.addEventListener('click', () => {
                    const indicator = document.getElementById(`indicator-${index}`);

                    if (video.paused) {
                        // Pause all other videos first
                        videos.forEach(otherVideo => {
                            if (otherVideo.id !== video.id) {
                                otherVideo.pause();
                                // Update other indicators
                                const otherIndex = otherVideo.id.split('-')[1];
                                const otherIndicator = document.getElementById(`indicator-${otherIndex}`);
                                if (otherIndicator) otherIndicator.textContent = 'Paused';
                            }
                        });

                        // Play this video
                        video.play();
                        if (indicator) indicator.textContent = 'Playing';
                    } else {
                        video.pause();
                        if (indicator) indicator.textContent = 'Paused';
                    }
                });

                // Update indicator when video plays/pauses
                video.addEventListener('play', () => {
                    const indicator = document.getElementById(`indicator-${index}`);
                    if (indicator) indicator.textContent = 'Playing';
                });

                video.addEventListener('pause', () => {
                    const indicator = document.getElementById(`indicator-${index}`);
                    if (indicator) indicator.textContent = 'Paused';
                });
            });
        }
    // Initialize the application
    async function initializeApp() {
        // First try to load data from the JSON file
        await loadComponentRepository();

        // Only call loadContent once with the default component
        loadContent('ui-setup-component-search');

        // Initialize video functionality
        initializeVideos();

        // Set up theme toggle functionality
        setupThemeToggle();

        // Add Component Manager to the "First Steps" category
        setTimeout(() => {
            document.querySelectorAll('.category-header').forEach(header => {
                if (header.textContent.trim().includes('First Steps')) {
                    firstStepsCategory = header.parentElement;
                }
            });

            if (firstStepsCategory) {
                // Find the items container
                const itemsContainer = firstStepsCategory.querySelector('.category-items');

                if (itemsContainer) {
                    // Create a new item for the component manager
                    const managerItem = document.createElement('a');
                    managerItem.href = '#';
                    managerItem.className = 'category-item';
                    managerItem.setAttribute('data-item', 'Component Manager');
                    managerItem.setAttribute('data-page', 'component-manager');
                    managerItem.innerHTML = `
                Component Data Manager
                <span class="category-item-indicator"></span>
            `;

                    // Add click event
                    managerItem.addEventListener('click', (e) => {
                        e.preventDefault();

                        // Remove active class from all items
                        document.querySelectorAll('.category-item').forEach(i => {
                            i.classList.remove('active');
                        });

                        // Add active class to clicked item
                        managerItem.classList.add('active');

                        // Display the component manager
                        createComponentManager();

                        // Scroll to top
                        scrollToTop();

                        // Close sidebar on mobile
                        closeSidebarOnMobile();
                    });

                    // Add to the container
                    itemsContainer.appendChild(managerItem);
                }
            }
        }, 400);
    };
        // Theme Toggle Functionality
        const themeToggle = document.getElementById('theme-toggle');

        // Check for saved theme preference or use system preference
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
            document.documentElement.setAttribute('data-theme', 'dark');
            themeToggle.checked = true;
        }

        // Toggle theme when switch is clicked
        themeToggle.addEventListener('change', function () {
            if (this.checked) {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
            }
        });

    window.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>